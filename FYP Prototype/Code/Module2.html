<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Module 2: Consumer Behaviour</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="../Code/style_module_2.css"> 
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js"></script>
</head>

<body>
<div id="module-2-content">
    <section id="scene1" class="fade-scene">
        <div class="kitchen-bg">
            <div class="overlay"></div>
            <div class="text-container">
                <p class="fade-text">The kitchen becomes the stage where food waste begins... <br>
                <b>Module 2: Consumer Behaviour</b></p>
            </div>
        </div>
    </section>

    <section class="fade_text_TLPPM" style="margin-top: -80px;"> 
        <div class="text_overlay_TLPPM">
            <p class="p_text">Across Asia, consumers purchase food as a vital part of daily survival, an essential need for every individual. <br> </p>
            <p class="p_text">But the largest portion of food waste does not occur in markets or restaurants... <br></p>
            <h1 class="focus">It begins at our home...</h1> <br>
            <p class="p_text"> Why does this happen? Let us explore the following chart to uncover the reasons and gain deeper insights.</p>
        </div>
    </section>

    <div class='tableauPlaceholder' id='viz1_container' style='position: relative;margin: 0 auto; width: 100%; max-width: 1080px;margin-top: 50px;'>
        <noscript>
            <a href='#'><img alt='Dashboard 1' src='https://public.tableau.com/static/images/Mo/Module2-barchart/Dashboard1/1_rss.png' style='border: none' /></a>
        </noscript>
        <object class='tableauViz' style='display:none;'>
            <param name='host_url' value='https%3A%2F%2Fpublic.tableau.com%2F' /> 
            <param name='embed_code_version' value='3' /> <param name='site_root' value='' />
            <param name='name' value='Module2-barchart/Dashboard1' /><param name='tabs' value='no' /><param name='toolbar' value='yes' />
            <param name='static_image' value='https://public.tableau.com/static/images/Mo/Module2-barchart/Dashboard1/1.png' /> 
            <param name='animate_transition' value='yes' /><param name='display_static_image' value='yes' /><param name='display_spinner' value='yes' />
            <param name='display_overlay' value='yes' /><param name='display_count' value='yes' /><param name='language' value='en-US' />
        </object>
    </div> Â  Â  Â  Â  Â  Â  
    <script type='text/javascript'> Â  Â  Â  Â  Â  Â  Â  Â  Â  Â 
        var divElement1 = document.getElementById('viz1_container'); Â  Â  Â  Â  Â  Â  Â  Â  Â  Â 
        var vizElement1 = divElement1.getElementsByTagName('object')[0]; Â  Â  Â  Â  Â  Â  Â  Â  Â  Â 
        if ( divElement1.offsetWidth > 800 ) { vizElement1.style.width='1080px';vizElement1.style.height='727px';} 
        else if ( divElement1.offsetWidth > 500 ) { vizElement1.style.width='1080px';vizElement1.style.height='727px';} 
        else { vizElement1.style.width='100%';vizElement1.style.height='727px';} Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  
        var scriptElement1 = document.createElement('script'); Â  Â  Â  Â  Â  Â  Â  Â  Â  Â 
        scriptElement1.src = 'https://public.tableau.com/javascripts/api/viz_v1.js'; Â  Â  Â  Â  Â  Â  Â  Â  Â  Â 
        vizElement1.parentNode.insertBefore(scriptElement1, vizElement1); Â  Â  Â  Â  Â  Â  Â  Â 
    </script>
    
    <section class="fade_text_TLPPM" style="margin-top: -30px;">
        <div class="text_overlay_TLPPM">
            <p class="p_text">Behind each bar line is about a story of meals prepared, leftovers discarded and opportunities lost... <br> 
            It reminding us that food waste is as much about individual behaviour...
        </div>
    </section>
    
    <section class="fade_text_TLPPM" style="margin-top: -80px;">
        <div class="text_overlay_TLPPM">
            <p class="p_text">As a Malaysian, have you ever wonderedâ€¦<br>
            What drives our consumer behaviour and why food waste keeps happening in daily life? 
        </div>
    </section>
    
    <section class="fade_text_TLPPM" style="margin-top: -80px;">
        <div class="text_overlay_TLPPM">
            <p class="p_text">Let us explore the chart belowâ€¦ It reveals the main causes and shows how Malaysians truly behave...</p>
        </div>
    </section>

    <div class='tableauPlaceholder' id='viz2_container' style='position: relative;margin: 0 auto; width: 100%; max-width: 1080px;margin-top: 50px;'>
        <noscript>
            <a href='#'><img alt='Malaysia Consumer Behaviour' src='https://public.tableau.com/static/images/Mo/Module2-PieChartv1/Module2-pieMalaysiaConsumerBehaviour/1_rss.png' style='border: none' /></a>
        </noscript>
        <object class='tableauViz' style='display:none;'>
            <param name='host_url' value='https%3A%2F%2Fpublic.tableau.com%2F' /> 
            <param name='embed_code_version' value='3' /> <param name='site_root' value='' />
            <param name='name' value='Module2-PieChartv1/Module2-pieMalaysiaConsumerBehaviour' />
            <param name='tabs' value='no' /><param name='toolbar' value='yes' />
            <param name='static_image' value='https://public.tableau.com/static/images/Mo/Module2-PieChartv1/Module2-pieMalaysiaConsumerBehaviour/1.png' /> 
            <param name='animate_transition' value='yes' /><param name='display_static_image' value='yes' />
            <param name='display_spinner' value='yes' /><param name='display_overlay' value='yes' />
            <param name='display_count' value='yes' /><param name='language' value='en-US' />
        </object>
    </div> Â  Â  Â  Â  Â  Â  
    <script type='text/javascript'> Â  Â  Â  Â  Â  Â  Â  Â  Â  Â 
        var divElement2 = document.getElementById('viz2_container'); Â  Â  Â  Â  Â  Â  Â  Â  Â  Â 
        var vizElement2 = divElement2.getElementsByTagName('object')[0]; Â  Â  Â  Â  Â  Â  Â  Â  Â  Â 
        vizElement2.style.width='100%';vizElement2.style.height=(divElement2.offsetWidth*0.75)+'px'; Â  Â  Â  Â  Â  Â  Â  Â  Â  Â 
        var scriptElement2 = document.createElement('script'); Â  Â  Â  Â  Â  Â  Â  Â  Â  Â 
        scriptElement2.src = 'https://public.tableau.com/javascripts/api/viz_v1.js'; Â  Â  Â  Â  Â  Â  Â  Â  Â  Â 
        vizElement2.parentNode.insertBefore(scriptElement2, vizElement2); Â  Â  Â  Â  Â  Â  Â  Â 
    </script>

    <section class="fade_text_TLPPM" style="margin-top: -80px;">
        <div class="text_overlay_TLPPM">
            <p class="p_text">From the chart we can see that, there are</p><br><h1 class="focus">32.15%</h1><br>
            <p class="p_text" style="font-size: 28px;">showing that the food waste occurs due to exceed expiration date.</p>
        </div>
    </section>
    
    <section class="fade_text_TLPPM" style="margin-top: -80px;">
        <div class="text_overlay_TLPPM">
            <p class="p_text">But.... does it really not edible? Or just because of...</p> <h1 class="focus"><b>misunderstanding...</b></h1>
        </div>
    </section>

    <div class='tableauPlaceholder' id='viz3_container' style='position: relative;margin: 0 auto; width: 100%; max-width: 1080px;margin-top: 50px;'>
        <noscript>
            <a href='#'><img alt='Sheet 1' src='https://public.tableau.com/static/images/Mo/Module_2-Malaysiaconsumerbehaviourpiechart1/Sheet1/1_rss.png' style='border: none' /></a>
        </noscript>
        <object class='tableauViz' style='display:none;'>
            <param name='host_url' value='https%3A%2F%2Fpublic.tableau.com%2F' /> 
            <param name='embed_code_version' value='3' /> <param name='site_root' value='' />
            <param name='name' value='Module_2-Malaysiaconsumerbehaviourpiechart1/Sheet1' />
            <param name='tabs' value='no' /><param name='toolbar' value='yes' />
            <param name='static_image' value='https://public.tableau.com/static/images/Mo/Module_2-Malaysiaconsumerbehaviourpiechart1/Sheet1/1.png' /> 
            <param name='animate_transition' value='yes' /><param name='display_static_image' value='yes' />
            <param name='display_spinner' value='yes' /><param name='display_overlay' value='yes' />
            <param name='display_count' value='yes' /><param name='language' value='en-US' />
        </object>
    </div> Â  Â  Â  Â  Â  Â  
    <script type='text/javascript'> Â  Â  Â  Â  Â  Â  Â  Â  Â  Â 
        var divElement3 = document.getElementById('viz3_container'); Â  Â  Â  Â  Â  Â  Â  Â  Â  Â 
        var vizElement3 = divElement3.getElementsByTagName('object')[0]; Â  Â  Â  Â  Â  Â  Â  Â  Â  Â 
        vizElement3.style.width='100%';vizElement3.style.height=(divElement3.offsetWidth*0.75)+'px'; Â  Â  Â  Â  Â  Â  Â  Â  Â  Â 
        var scriptElement3 = document.createElement('script'); Â  Â  Â  Â  Â  Â  Â  Â  Â  Â 
        scriptElement3.src = 'https://public.tableau.com/javascripts/api/viz_v1.js'; Â  Â  Â  Â  Â  Â  Â  Â  Â  Â 
        vizElement3.parentNode.insertBefore(scriptElement3, vizElement3); Â  Â  Â  Â  Â  Â  Â  Â 
    </script> Â 
    
    <section class="fade_text_TLPPM" style="margin-top: -80px;">
        <div class="text_overlay_TLPPM">
            <p class="p_text" style="font-size: 28px;" id="expiryDateTriggerText"> Surprisingly,</p><h1 class="focus">33.77%</h1><br> <p class="p_text" style="font-size: 28px;" id="expiryDateTriggerText">of Malaysians say they cannot differentiate between â€œuse byâ€ and â€œbest before.â€ </p><br>
            <p class="p_text" style="font-size: 28px;" id="expiryDateTriggerText"> So, what do these labels really mean? Let have a look on this explanation...</p>
        </div>
    </section>
    
    <section class="scroll-lock-wrapper-module2" id="scroll-wrapper-1">
        <div class="scroll-hint" style="font-size: 35px;">Scroll to Continue</div>
        <div class="text-box">
            <h2 class="text-line">"Use By"</h2>
            <h2 class="text-line" style="font-size: 45px;">Means</h2>
            <h2 class="text-line">"Eat the food before this date. </h2>
            <h2 class="text-line">After that, it may be unsafe."</h2>
        </div>
    </section>
    
    <section class="scroll-lock-wrapper-module2" id="scroll-wrapper-2">
        <div class="scroll-hint" style="font-size: 35px;">Scroll to Continue</div>
        <div class="text-box">
            <h2 class="text-line">"Best Before"</h2>
            <h2 class="text-line" style="font-size: 45px;">Means</h2>
            <h2 class="text-line">"Eat the food before this date for best quality."</h2>
        </div>
    </section>
    
    <section class="fade_text_TLPPM">
        <div class="text_overlay_TLPPM">
            <p class="p_text" style="font-size: 28px;">By understanding the meaning of these labels helps to reduce the food waste add up...<br>
            But do you figure that the hiding reality you have yet notice in your life...</p>
        </div> Â 
    </section>
    
    <button id="loadModule3" onclick="loadChapter3()" style=" padding: 12px 22px; font-size: 18px; background:#69b3a2; color: #111; border:none; border-radius:6px; cursor:pointer; margin: 40px auto; display:block;"> Chapter 3 </button>

</div>

<script>
    /* -------------------------------------------
    * ğŸš€ CORE MODULE 2 JAVASCRIPT LOGIC
    * This replaces your module_2.js and inline script.
    * ------------------------------------------- */

    gsap.registerPlugin(ScrollTrigger);

    /**
     * Handles clicks on the vertical navigation menu dots.
     * @param {string} targetId The ID selector (e.g., '#scene1') of the element to scroll to.
     */
    function handleNavigation(targetId) {
        const el = document.querySelector(targetId);
        if (el) {
            el.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }
    }

    /**
     * Handles the click on the Chapter 3 button.
     * Customize this to your desired navigation (e.g., redirecting to a new page).
     */
    function loadChapter3() {
        alert("Redirecting to Chapter 3! (Customize this function to navigate to your next HTML page)");
        // Example for redirecting:
        // window.location.href = 'module_3.html'; 
    }

    /**
     * Initializes the IntersectionObserver for elements with the .fade_text_TLPPM class.
     * This makes text fade in as it enters the viewport.
     */
    function initFadeTextObservers() {
        const fadeSections = document.querySelectorAll(".fade_text_TLPPM");

        const obs = new IntersectionObserver(entries => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.add("visible");
                    obs.unobserve(entry.target); 
                }
            });
        }, { threshold: 0.3 }); // Triggers when 30% of the element is visible

        fadeSections.forEach(section => obs.observe(section));
    }


    /* -------------------------------------------
    * GSAP ANIMATIONS
    * ------------------------------------------- */

    // --- Animation for Wrapper 1 (Use By) ---
    const tl1 = gsap.timeline({
        scrollTrigger: {
            trigger: "#scroll-wrapper-1", 
            start: "top top", 
            end: "+=300%", 
            pin: true, 
            scrub: 1, 
        }
    });

    tl1.to("#scroll-wrapper-1 .text-line", { 
        backgroundPosition: "0% 0", // Assuming CSS sets up the text mask effect
        ease: "none", 
        stagger: 0.5, 
        duration: 1 
    });


    // --- Animation for Wrapper 2 (Best Before) ---
    const tl2 = gsap.timeline({
        scrollTrigger: {
            trigger: "#scroll-wrapper-2", 
            start: "top top", 
            end: "+=300%", 
            pin: true, 
            scrub: 1, 
        }
    });
    
    tl2.to("#scroll-wrapper-2 .text-line", { 
        backgroundPosition: "0% 0", 
        ease: "none", 
        stagger: 0.5, 
        duration: 1 
    });

    /* -------------------------------------------
    * INITIALIZATION
    * ------------------------------------------- */
    document.addEventListener("DOMContentLoaded", () => {
        // Run the fade-in logic for all standard text sections
        initFadeTextObservers();
        console.log("All observers and animations initialized.");
    });
    
    // Add a new flag for Module 3
let module3Loaded = false; 
let sectionLoaded = false; // Your existing flag for Module 2

// Function to load Module 3
function loadChapter3() {
    if (module3Loaded) {
        // If already loaded, just scroll to it
        document.getElementById('nextSection3').scrollIntoView({ behavior: 'smooth', block: 'start' });
        return;
    }
    module3Loaded = true;
    console.log("Fetching Module 3...");

    const nextSection3 = document.getElementById('nextSection3');
    const currentScrollY = window.scrollY;

    (async () => {
        try {
            // Use the file name created in Step 1
            const response = await fetch('Module3.html'); 
            if (!response.ok) throw new Error("Network response was not ok");
            const html = await response.text();

            // 1. Inject HTML and set up initial state
            nextSection3.innerHTML = html;
            nextSection3.style.opacity = 0;
            nextSection3.style.transition = 'opacity 1s ease-out';

            // 2. Initialize dynamic elements for Module 3
            // NOTE: You must create initModule3Observers, initModule3Charts, etc.
            initModule2Observers(nextSection3); // Reuse Module 2 observers for text fade-in
            // initModule3Charts(); // Placeholder: Define this to load Module 3 Tableau charts
            // initModule3GSAP(); // Placeholder: Define this for Module 3 GSAP animations

            // 3. Wait for content to settle
            await waitForContentToSettle(nextSection3, 3000);

            requestAnimationFrame(() => {
                if (window.ScrollTrigger) {
                    ScrollTrigger.refresh();
                }
                
                // 4. Scroll to the START of the new section (Module 3 content)
                nextSection3.scrollIntoView({ behavior: 'smooth', block: 'start' });
                
                // 5. Fade in the new section
                nextSection3.style.opacity = 1;
                console.log("Module 3 HTML injected, scrolled, and faded in.");
            });
        } catch (err) {
            console.error('Failed to load Module 3:', err);
            module3Loaded = false;
        }
    })();
}
</script>
</body>
</html>